#!/bin/sh

#SBATCH --partition=general
#SBATCH --qos=short
#SBATCH --time=4:00:00
#SBATCH --ntasks=1

#SBATCH --cpus-per-task=10
#SBATCH --gres=gpu:a40
#SBATCH --mem-per-cpu=10G
#SBATCH --mail-type=ALL

module use /opt/insy/modulefiles
module load cuda/12.1


previous=$(/usr/bin/nvidia-smi --query-accounted-apps='gpu_utilization,mem_utilization,max_memory_usage,time' --format='csv' | /usr/bin/tail -n '+2')


srun python bert.py

/usr/bin/nvidia-smi --query-accounted-apps='gpu_utilization,mem_utilization,max_memory_usage,time' --format='csv' | /usr/bin/grep -v -F "$previous"
