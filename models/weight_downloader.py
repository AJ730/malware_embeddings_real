from transformers import AutoModelForSequenceClassification, AutoTokenizer

from utils.database_utils.database_malware_dataset import StratifiedDatabaseMalwareDatasetSqlite

if __name__ == '__main__':

    # Define the model checkpoint
    model_checkpoint =  "allenai/longformer-base-4096"
    # Your Hugging Face API token
    hf_token = "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"

    # Load the tokenizer and model
    tokenizer = AutoTokenizer.from_pretrained(model_checkpoint)

    train_dataset = StratifiedDatabaseMalwareDatasetSqlite(tokenizer=tokenizer, version=4000 ,split='train', max_length=4096)
    model = AutoModelForSequenceClassification.from_pretrained(model_checkpoint, use_auth_token=hf_token, num_labels=train_dataset.get_num_labels())  # Adjust num_labels as per your requirement

    # Define the directory to save the model and tokenizer
    model_dir = "longformer-4096-model"
    tokenizer_dir = "longformer-4096-tokenizer"

    # Save the tokenizer and model
    tokenizer.save_pretrained(tokenizer_dir)
    model.save_pretrained(model_dir)

    print(f"Model and tokenizer saved to {model_dir} and {tokenizer_dir} respectively.")
